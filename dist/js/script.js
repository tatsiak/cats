"use strict";var cats,catTemplate=document.querySelector("#cat-template"),catsContainer=document.querySelector(".container.cats"),content=document.querySelector(".content"),filterElement=document.querySelector(".filter"),headerCart=document.querySelector(".header__cart"),cartItems=headerCart.querySelector(".header__cart_items"),load=document.querySelector("#load"),gettingData=!1,isBuilding=0,pageCount=1,filterArray=[];function getCatsData(){if(isElementInViewport(load)&&!gettingData){gettingData=!0;var e=new XMLHttpRequest,t="https://ma-cats-api.herokuapp.com/api/cats?page="+pageCount;e.open("GET",t,!1),e.onload=function(){if(200<=e.status&&e.status<400){var t=JSON.parse(e.responseText);pageCount++,t.cats.forEach(function(t){if(catsContainer.appendChild(getCatMarkup(t)),!filterArray.includes(t.category)){filterArray.push(t.category);var e=document.createElement("button");e.innerHTML=t.category,e.classList.add(t.category),filterElement.addEventListener("click",filterTrigger),filterElement.appendChild(e)}}),(cats=catsContainer.querySelectorAll(".cat")).forEach(function(t){t.addEventListener("dragstart",onDrag)})}else console.error(e.responseText)},e.send(null),gettingData=!1}}function getCatMarkup(t){var e=document.importNode(catTemplate.content,!0);e.querySelector(".cat-card__price").textContent=t.price;var a=Modernizr.svg?t.img_url:"img/default_cat.png";return e.querySelector(".cat-card__image").setAttribute("style",'background-image: url("'+a+'")'),e.querySelector(".cat-data__name").textContent=t.name,e.querySelector(".cat-data__id").textContent=t.id,e.querySelector(".cat-data__category").textContent=t.category,e.querySelector(".cat").id=t.id,e}function filterTrigger(t){var e=t.target.classList[0];t.target.classList.toggle("filter__active"),cats.forEach(function(t){t.querySelector(".cat-data__category").textContent==e&&t.classList.toggle("hide")})}function isElementInViewport(t){var e=t.getBoundingClientRect();return 0<e.bottom&&0<e.right&&e.left<(window.innerWidth||document.documentElement.clientWidth)&&e.top<(window.innerHeight||document.documentElement.clientHeight)}function onDrag(t){t.dataTransfer.dropEffect="move",t.dataTransfer.effectAllowed="move";var e=t.target||t.srcElement,a=t.dataTransfer.setData("id",e.id);console.log(a)}function onDragOver(t){return t.preventDefault&&t.preventDefault(),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,!1}function addCartItem(t){var e=document.getElementById(t),a=e.cloneNode(!0);a.setAttribute("data-id",t),a.removeAttribute("id"),a.classList.add("header__cart_item"),headerCart.querySelector(".empty").classList.add("hide"),cartItems.appendChild(a),e.classList.add("hide")}function onDrop(t){t.preventDefault&&t.preventDefault(),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0;var e=t.dataTransfer.getData("id");addCartItem(e);var a=window.localStorage.getItem("itemsInCart");return a=a?a+","+e:e,window.localStorage.setItem("itemsInCart",a),!1}getCatsData(),content.addEventListener("scroll",getCatsData),headerCart.addEventListener("dragover",onDragOver),headerCart.addEventListener("drop",onDrop),function(){var t=window.localStorage.getItem("itemsInCart");t&&(t=t.split(",")).forEach(function(t){addCartItem(t)})}();